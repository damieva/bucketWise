{{- if (.Values.mongodb.enabled | default false) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "bucketwise-backend.fullname" . }}-mongo-init
data:
  init.sh: |
    #!/bin/bash
    set -e

    DB_NAME="${MONGO_INITDB_DATABASE:-bucketWise}"

    echo "üèóÔ∏è Inicializando base de datos '$DB_NAME'..."

    mongosh "$MONGO_URI" <<EOF
    use $DB_NAME

    if (!db.getCollectionNames().includes("categories")) {
      db.createCollection("categories");
      print("‚úÖ Colecci√≥n 'categories' creada");
    } else {
      print("‚ÑπÔ∏è Colecci√≥n 'categories' ya existe");
    }

    if (!db.getCollectionNames().includes("transactions")) {
      db.createCollection("transactions");
      print("‚úÖ Colecci√≥n 'transactions' creada");
    } else {
      print("‚ÑπÔ∏è Colecci√≥n 'transactions' ya existe");
    }
    EOF
{{- end }}